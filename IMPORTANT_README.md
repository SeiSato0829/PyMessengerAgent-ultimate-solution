# ⚠️ 重要：Facebook Messenger API の制限事項

## 🚨 根本的な問題

**Facebook APIでは、友達じゃない人への直接メッセージ送信は不可能です**

### なぜ動作しないのか？

1. **個人アカウントの制限**
   - Facebook APIは個人アカウントから友達以外へのメッセージ送信を禁止
   - これはスパム防止のためのFacebookポリシー
   - `pages_messaging`権限は個人アカウントでは取得不可

2. **Facebook Pageの制限**
   - Pageからも初回メッセージは送信不可
   - 相手が先にPageにメッセージを送ってきた場合のみ返信可能
   - 24時間以内の返信制限あり

3. **現在のエラー原因**
   - 「必要な権限がありません」エラー
   - アクセストークンは有効だが、メッセージ送信権限が存在しない
   - これは設定の問題ではなく、Facebook APIの仕様

## ✅ 実現可能な代替案

### 1. Facebook Page Bot（推奨）
```
1. Facebook Pageを作成
2. Messenger Platformを設定
3. Webhookを設定
4. ユーザーがPageにメッセージを送信した後に自動返信
```

### 2. Facebook広告API
```
1. 広告キャンペーンを作成
2. Messenger広告として配信
3. クリックした人とメッセージ開始
```

### 3. QRコード/リンク共有
```
1. m.me/ページ名 のリンクを生成
2. QRコードやリンクを共有
3. クリックした人とチャット開始
```

## 🔧 現在のシステムで可能なこと

- ✅ Facebook認証
- ✅ プロフィール情報取得
- ✅ 友達リスト取得（権限があれば）
- ✅ 友達へのメッセージ送信
- ❌ 友達じゃない人への直接メッセージ（不可能）

## 📝 結論

**「友達じゃない人にもメッセージ送信可能」という機能は、Facebook APIの仕様上実現不可能です。**

これは技術的な問題ではなく、Facebookのポリシーによる制限です。

## 推奨される次のステップ

1. **要件の見直し**
   - Facebook Page Botへの移行を検討
   - または別のメッセージングプラットフォーム（WhatsApp Business API等）を検討

2. **現実的な機能への変更**
   - 友達へのメッセージ送信機能
   - Facebook Pageの自動返信ボット
   - メッセージテンプレートの管理システム

---

作成日: 2024年12月
最終更新: 2024年12月17日
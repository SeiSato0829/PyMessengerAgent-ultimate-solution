services:
  - type: web
    name: pymessenger-agent-pro
    env: node
    plan: starter  # $7/month - æ¨å¥¨
    # plan: standard  # $25/month - é«˜è² è·å¯¾å¿œ
    # plan: pro  # $85/month - ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º
    
    region: oregon
    buildCommand: |
      echo "ğŸš€ Starting enterprise build..."
      npm ci
      npm run lint:strict
      npm run build
      echo "âœ… Build completed successfully"
      
    startCommand: npm start
    
    # ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³ãªã‚‰ç„¡åˆ¶é™ãƒ“ãƒ«ãƒ‰æ™‚é–“
    # é«˜æ€§èƒ½CPUãƒ»ãƒ¡ãƒ¢ãƒªã§ãƒ•ãƒ«ãƒ“ãƒ«ãƒ‰å¯èƒ½
    
    healthCheckPath: /api/health
    
    envVars:
      # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
      - key: NODE_ENV
        value: production
        
      - key: NODE_OPTIONS
        value: --max-old-space-size=1800  # ãƒ—ãƒ­ãƒ—ãƒ©ãƒ³ã®è±Šå¯Œãƒ¡ãƒ¢ãƒªæ´»ç”¨
        
      # Supabaseè¨­å®šï¼ˆæœ¬æ ¼é‹ç”¨ï¼‰
      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false  # æ‰‹å‹•è¨­å®š
        
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false
        
      - key: SUPABASE_SERVICE_KEY
        sync: false
        
      # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
      - key: JWT_SECRET
        generateValue: true
        
      - key: ENCRYPTION_KEY
        generateValue: true
        
      - key: API_SECRET_KEY
        generateValue: true
        
      # Facebook APIè¨­å®š
      - key: FACEBOOK_APP_ID
        sync: false
        
      - key: FACEBOOK_APP_SECRET
        sync: false
        
      # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®šï¼ˆPostgreSQL Proï¼‰
      - key: DATABASE_URL
        sync: false
        
      # ç›£è¦–ãƒ»ãƒ­ã‚°è¨­å®š
      - key: LOG_LEVEL
        value: info
        
      - key: SENTRY_DSN
        sync: false
        
      # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š
      - key: ENABLE_ANALYTICS
        value: "true"
        
      - key: ENABLE_REAL_TIME
        value: "true"
        
      - key: CACHE_TTL
        value: "3600"

# PostgreSQL Pro ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹        
databases:
  - name: pymessenger-db-pro
    databaseName: pymessenger_pro
    user: pymessenger_admin
    plan: starter  # $7/month PostgreSQL
    # plan: standard  # $20/month - ã‚ˆã‚Šé«˜æ€§èƒ½
    region: oregon

# è¿½åŠ ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆãƒ—ãƒ­ãƒ—ãƒ©ãƒ³ãªã‚‰åˆ©ç”¨å¯èƒ½ï¼‰
# Redisï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ï¼‰
# - type: redis
#   name: pymessenger-cache
#   plan: starter
#   maxmemoryPolicy: allkeys-lru

# Cron Jobsï¼ˆå®šæœŸå®Ÿè¡Œã‚¿ã‚¹ã‚¯ï¼‰
# - type: cron
#   name: daily-cleanup
#   schedule: "0 2 * * *"  # æ¯æ—¥åˆå‰2æ™‚
#   buildCommand: npm ci --only=production
#   startCommand: npm run cleanup